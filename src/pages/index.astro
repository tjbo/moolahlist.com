---
import Welcome from "../components/Welcome.astro";
import Layout from "../components/Layout.astro";
import Section from "../components/Section.astro";
import PrismicSlices from "../components/PrismicSlices.astro";
import { getPage, getUrl } from "../prismic.js";
const page = await getPage("root");

const response = await fetch(
  "https://us-east-1.cdn.hygraph.com/content/cke1u42u73qoz01z20ckw7eij/master",
  {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Accept: "application/json",
    },
    body: JSON.stringify({
      query: `
        {
          lenderProfiles(stage: PUBLISHED) {
            name
            logo {
              url(
                transformation: {
                  image: {
                    resize: {
                      width: 400
                      height: 400
                      fit: crop
                    }
                  }
                }
              )
              fileName
              width
              height
              size
            }
            slug
          }
        }
      `,
    }),
  },
);

const _r = await response.json();

const profiles = _r.data.lenderProfiles.map((profile) => {
  return { ...profile };
});
---

<Layout>
  <PrismicSlices body={page.data.body1} />
  <Section>
    <h2>Recently Added</h2>
    <ul>
      {
        profiles.map((p) => {
          return (
            <li>
              <a href={`/profile/${p.slug}`}>{p.name}</a>
            </li>
          );
        })
      }
    </ul>
  </Section>
</Layout>
