---
import * as prismic from "@prismicio/client";
const { deal } = Astro.props;
import { marked } from "marked";
import generateSrcSets from "../utils/generateSrcSets.js";
import getImageUrlFromSize from "../utils/getImageUrlFromSize.js";
import { getDomain } from "tldts";

// const image = deal.image;
// const srcSets =
//   !!deal.image &&
//   !!deal.image.url &&
//   generateSrcSets(
//     deal.image.url,
//     [
//       { w: 640, h: 360 },
//       { w: 480, h: 270 },
//       { w: 320, h: 180 },
//       { w: 240, h: 135 },
//       { w: 160, h: 90 },
//     ],
//     true,
//   );
const hasImage = !!deal.image && !!deal.image.length;
---

<div
  class=`grid ${hasImage ? "grid-cols-1 md:grid-cols-[auto_300px]" : "grid-cols-1"} gap-6`
>
  <div>
    <h4>
      <a href={deal.link} target="_blank">
        {deal.headline}
        <span class="text-black text-sm">
          <svg
            stroke="currentColor"
            class="inline"
            fill="currentColor"
            stroke-width="0"
            viewBox="0 0 24 24"
            height="1.5em"
            width="1.5em"
            xmlns="http://www.w3.org/2000/svg"
            ><path fill="none" d="M0 0h24v24H0z"></path><path
              d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"
            ></path></svg
          >

          {getDomain(deal.link)}</span
        >
      </a>
    </h4>
    <div set:html={marked(deal.body)} />
    <a href={deal.link} target="_blank" class="mt-4 block"> Read more </a>
  </div>
  {
    !!deal.image && !!deal.image.length ? (
      <img
        sizes="(max-width: 640px) 95vw, (min-width: 768px) 44vw, (min-width: 1252px) 552px"
        src={deal.image[0].url}
      />
    ) : null
  }
</div>
