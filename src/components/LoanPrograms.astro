---
const { program } = Astro.props;
import {
  formatAmount,
  formatInterestRate,
  formatLTV,
  formatTerm,
} from "../utils/formatNumbers.js";
import numeral from "numeral";
import Button from "./Button.astro";
import { PROPERTY_TYPES } from "../constants/enums.js";
import { hasArrayWithStrings } from "../utils/array.js";
import { DOCUMENTATION, LENDING_RATIOS_SHORTHAND } from "../constants/enums.js";

import LoanSpecs from "./LoanSpecs.astro";

import LoanProgramsStat from "./LoanProgramsStat.astro";
import Stat from "./Stat.astro";

const propertyTypes = program.propertyTypes.map((item) => {
  return PROPERTY_TYPES[item];
});
---

<div class="block p-4 md:p-12 border-solid border-secondary-light border-1">
  <div class="flex flex-row w-full justify-between">
    <div class="font-bold text-2xl"></div>
  </div>
  <h3 class="!mb-0">{program.title}</h3>
  <p class="mt-0">{program.description}</p>
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
    <LoanProgramsStat
      label={LENDING_RATIOS_SHORTHAND[program.lendingRatios[0].type]}
      stat={formatLTV(program.lendingRatios[0].value)}
    />
    <LoanProgramsStat
      label="Interest"
      stat={formatInterestRate(
        program.interestRateMin,
        program.interestRateMax,
      )}
    />
    <LoanProgramsStat
      label="Amounts"
      stat={formatAmount(program.loanAmountMin, program.loanAmountMax)}
    />
    <LoanProgramsStat
      label="Term"
      stat={formatTerm(program.termLengthMin, program.termLengthMax)}
    />
  </div>
  <h4 class="mt-6">Loan Guidelines</h4>
  <ul>
    <li>Funded in {program.closingTimeMin} to {program.closingTimeMax} days</li>
    <li>
      {program.originationFeeMin} to
      {program.originationFeeMax} origination points
    </li>
  </ul>
  <h4>Eligible Property Types</h4>
  <ul>
    <li>{propertyTypes.join(", ")}</li>
  </ul>

  {
    hasArrayWithStrings(program.keyRequirements) ? (
      <>
        <h4>Key Requirements</h4>
        <ul>
          {program.keyRequirements.map((item) => {
            return <li>{item}</li>;
          })}
        </ul>
      </>
    ) : null
  }
  {
    hasArrayWithStrings(program.documentation) ? (
      <>
        <h4>Documentation</h4>
        <ul>
          {program.documentation.map((item) => {
            return <li>{DOCUMENTATION[item]}</li>;
          })}
        </ul>
      </>
    ) : null
  }

  {
    hasArrayWithStrings(program.additionalDetails) ? (
      <>
        <h4>Additional Details</h4>
        <ul>
          {program.additionalDetails.map((item) => {
            return <li>{item}</li>;
          })}
        </ul>
      </>
    ) : null
  }

  <div class="flex justify-center gap-4 mt-16">
    <Button
      data-open-modal={program.loanType}
      extraClass="min-w-[200px]"
      href="#"
      variant="outline">See all loan specs</Button
    >
    <!-- Button extraClass="min-w-[200px]" href="#">Apply </Button-->
  </div>
</div>
<div id="loanSpecs">
  <LoanSpecs program={program} id={program.loanType} />
</div>
